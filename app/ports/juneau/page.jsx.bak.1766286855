"use client";



import dynamic from "next/dynamic";
import { useMemo, useRef, useState } from "react";
import HoloIntro from "../../components/holo/HoloIntro";

const HoloMapScene = dynamic(() => import("../../components/holo/HoloMapScene"), { ssr: false });

// These UVs are “map points” on the image (0..1).
// You’ll tune these once your Juneau image is final.
const LOCATIONS = [
  { id: "dock", name: "Cruise Dock Terminal", uv: [0.70, 0.35], tag: "PORT" },
  { id: "downtown", name: "Downtown Juneau", uv: [0.56, 0.46], tag: "CORE" },
  { id: "mendenhall", name: "Mendenhall Glacier", uv: [0.20, 0.70], tag: "ICON" },
  { id: "whales", name: "Whale Watching Zone", uv: [0.82, 0.52], tag: "WATER" },
];

export default function JuneauHologramPage() {
  const hoverUvRef = useRef({ x: -10, y: -10 });
  const hoverOnRef = useRef(false);

  const [introDone, setIntroDone] = useState(false);
  const [activeId, setActiveId] = useState(null);

  const active = useMemo(() => LOCATIONS.find((x) => x.id === activeId), [activeId]);

  function setHover(loc) {
    if (!loc) {
      hoverOnRef.current = false;
      setActiveId(null);
      return;
    }
    hoverUvRef.current = { x: loc.uv[0], y: loc.uv[1] };
    hoverOnRef.current = true;
    setActiveId(loc.id);
  }

  return (
    <div className="holoPage">
      {!introDone && <HoloIntro onDone={() => setIntroDone(true)} />}

      {/* Top HUD */}
      <div className="holoHudTop">
        <div className="holoHudLeft">
          <div className="holoBadge">DCC • WTA</div>
          <div className="holoTitle">Juneau Port Overlay</div>
          <div className="holoMeta">LOCKED VIEW • INTERACTIVE TARGETS • MONETIZED ENDPOINT</div>
        </div>
        <div className="holoHudRight">
          <div className="holoStat">
            <div className="k">NODE</div><div className="v">JNU-01</div>
          </div>
          <div className="holoStat">
            <div className="k">STATUS</div><div className="v ok">LIVE</div>
          </div>
          <div className="holoStat">
            <div className="k">FOCUS</div><div className="v">{active ? active.tag : "—"}</div>
          </div>
        </div>
      </div>

      {/* Main stage */}
      <div className="holoStage">
        <div className="holoMapFrame photoMode">
          <div className="holoFrameEdge" />
          <div className="holoGlass holoBg" />
          <HoloMapScene
            textureUrl="/textures/juneau.jpg"
            hoverUvRef={hoverUvRef}
            hoverOnRef={hoverOnRef}
            intensity={1}
          />
          <div className="holoScanlines" />
        </div>

        {/* Right panel */}
        <aside className="holoSide">
          <div className="holoSideHeader">
            <div className="holoSideTitle">Tour Locations</div>
            <div className="holoSideSub">Hover to target • click later to open tour cards</div>
          </div>

          <div className="holoList">
            {LOCATIONS.map((loc) => (
              <button
                key={loc.id}
                className={`holoItem ${activeId === loc.id ? "active" : ""}`}
                onMouseEnter={() => setHover(loc)}
                onMouseLeave={() => setHover(null)}
                onFocus={() => setHover(loc)}
                onBlur={() => setHover(null)}
              >
                <div className="holoItemLeft">
                  <div className="dot" />
                  <div className="name">{loc.name}</div>
                </div>
                <div className="tag">{loc.tag}</div>
              </button>
            ))}
          </div>

          <div className="holoCta">
            <button className="holoPrimary">Explore Juneau Tours</button>
            <div className="holoFinePrint">This is where your booking widgets / cart hooks live.</div>
          </div>
        </aside>
      </div>
    </div>
  );
}
